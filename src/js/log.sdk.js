var k=Object.defineProperty;var S=(t,e,o)=>e in t?k(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var u=(t,e,o)=>S(t,typeof e!="symbol"?e+"":e,o);function I(t,e,o){Object.defineProperty(t,e,{writable:!0,enumerable:!0,configurable:!0,value:o})}function O(t,e,o,n){I(t,e,o)}Array(32);class P{constructor(e){this.total=0,this.count=0,this.peddings=[],this.total=e}append(e){this.peddings.push(e),this.run()}run(){if(!this.peddings.length||this.count>=this.total)return;const e=this.peddings.shift();e&&(this.count++,e().finally(()=>{this.count--,this.run()}))}}class E{constructor(e){this.timer=null,this.time=10,this.count=10,this.arr=[];var o,n,r;this.time=(o=e.time)!=null?o:10,this.count=(n=e.count)!=null?n:10,this.ccController=new P((r=e.maxReqCount)!=null?r:10),e.host.startsWith("http://")||e.host.startsWith("https://")?this.url=e.host+"/logstores/"+e.logstore+"/track":this.url="https://"+e.project+"."+e.host+"/logstores/"+e.logstore+"/track",this.opt=e,e.installUnloadHook&&typeof e.installUnloadHook=="function"&&e.installUnloadHook(()=>{this.sendImmediateInner()})}assemblePayload(e){const o={__logs__:e};return this.opt.tags&&(o.__tags__=this.opt.tags),this.opt.topic&&(o.__topic__=this.opt.topic),this.opt.source&&(o.__source__=this.opt.source),JSON.stringify(o)}platformSend(){if(this.opt.sendPayload&&typeof this.opt.sendPayload=="function"){const e=this.assemblePayload(this.arr);this.ccController.append(()=>this.opt.sendPayload(this.url,e))}}transString(e){let o={};for(let n in e)typeof e[n]=="object"?o[n]=JSON.stringify(e[n]):o[n]=String(e[n]);return o}sendImmediateInner(){this.arr&&this.arr.length>0&&(this.platformSend(),this.timer!=null&&(clearTimeout(this.timer),this.timer=null),this.arr=[])}sendInner(){if(this.timer)this.arr.length>=this.count&&(clearTimeout(this.timer),this.timer=null,this.sendImmediateInner());else{const e=this;this.arr.length>=this.count||this.time<=0?this.sendImmediateInner():this.timer=setTimeout(function(){e.sendImmediateInner()},this.time*1e3)}}send(e){const o=this.transString(e);this.arr.push(o),this.sendInner()}sendImmediate(e){const o=this.transString(e);this.arr.push(o),this.sendImmediateInner()}sendBatchLogs(e){const o=e.map(n=>this.transString(n));this.arr.push(...o),this.sendInner()}sendBatchLogsImmediate(e){const o=e.map(n=>this.transString(n));this.arr.push(...o),this.sendImmediateInner()}overwriteTransString(e){this.transString=e.transString}getOpt(){return this.opt}}var g=(t,e,o)=>new Promise((n,r)=>{var i=c=>{try{l(o.next(c))}catch(s){r(s)}},a=c=>{try{l(o.throw(c))}catch(s){r(s)}},l=c=>c.done?n(c.value):Promise.resolve(c.value).then(i,a);l((o=o.apply(t,e)).next())});function B(t,e){return navigator&&navigator.sendBeacon?navigator.sendBeacon(`${t}?APIVersion=0.6.0`,e):!1}function y(t,e){const o=new window.XMLHttpRequest;o.open("POST",`${t}?APIVersion=0.6.0`,!0),o.send(e)}function T(t,e){try{if(e.length>=32768){y(t,e);return}B(t,e)||y(t,e)}catch(o){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+o),console.error("Failed log data:",t))}}function M(t,e,o){return g(this,null,function*(){return new Promise(n=>g(this,null,function*(){try{t=t.slice(0,-6);const{data:r,header:i}=yield o.process(t,e),a=new window.XMLHttpRequest;a.open("POST",t,!0);for(let l in i)a.setRequestHeader(l,i[l]);a.onreadystatechange=()=>{a.readyState===4&&(a.status===200||window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+a.status),console.error("Failed logdata:",t)),n())},a.send(r)}catch(r){window&&window.console&&typeof window.console.error=="function"&&(console.error(`Failed to log to ali log service because of this exception:
`+r),console.error("Failed log data:",t))}}))})}class b extends E{constructor(e){const o=Object.assign({},e,{installUnloadHook:n=>{window.addEventListener("beforeunload",()=>{n()})},sendPayload:(n,r)=>g(this,null,function*(){T(n,r)})});super(o)}useStsPlugin(e){this.getOpt().sendPayload=(o,n)=>g(this,null,function*(){yield M(o,n,e)}),this.overwriteTransString(e)}}O(window,"SLS_Tracker",b);var d=(t=>(t.evt_error="evt_error",t.evt_unhandledrejection="evt_unhandledrejection",t.evt_page_view="evt_page_view",t.evt_device_info="evt_device_info",t.evt_performance="evt_performance",t.evt_visit_source="evt_visit_source",t.evt_share="evt_share",t.evt_click="evt_click",t.evt_input="evt_input",t.evt_console_log="evt_console_log",t.evt_console_error="evt_console_error",t.evt_console_warn="evt_console_warn",t.evt_test="evt_test",t))(d||{});const L=(t,e=2e3)=>{let o;return n=>{o&&clearTimeout(o),o=window.setTimeout(()=>t(n),e)}};function H(t){let e=[];const o=JSON.stringify(t,function(n,r){if(typeof r=="object"&&r!==null){if(e.indexOf(r)!==-1)return;e.push(r)}return r});return e=null,o}const j=()=>{const{phone_province:t,phone_city:e,phone:o}=window._userData.phone_info;return{page_length:`${screen.availHeight/document.documentElement.scrollHeight*screen.availHeight}/${document.body.clientHeight}`,current_page_length:document.documentElement.scrollTop,phone_province:t,phone_city:e,phone:o}},A=t=>{var r,i,a,l,c;const e=[{label:"MicroMessenger",versionReg:new RegExp(/MicroMessenger(.*)\)/)},{label:"MiuiBrowser",versionReg:new RegExp(/XiaoMi(.*)/)},{label:"HuaweiBrowser",versionReg:new RegExp(/HuaweiBrowser(.*)\s/)},{label:"VivoBrowser",versionReg:new RegExp(/VivoBrowser(.*)/)},{label:"bdhonorbrowser",versionReg:new RegExp(/bdhonorbrowser(.*)\s/)},{label:"MQQBrowser",versionReg:new RegExp(/MQQBrowser(.*)\s/)},{label:"baiduboxapp",versionReg:new RegExp(/baiduboxapp(.*)\s/)},{label:"Quark",versionReg:new RegExp(/Quark(.*)\s/)},{label:"UCBrowser",versionReg:new RegExp(/UCBrowser(.*)\s/)},{label:"Chrome",versionReg:new RegExp(/Chrome(.*)\s/)},{label:"Safari",versionReg:new RegExp(/Safari(.*)/)}],o=[{label:"Edg",versionReg:new RegExp(/Edg(.*)/)},{label:"Firefox",versionReg:new RegExp(/Firefox(.*)/)},{label:"WindowsWechat",versionReg:new RegExp(/MicroMessenger(.*)\){1}/)},{label:"QIHU 360EE",versionReg:"//"},{label:"QIHU 360SE",versionReg:"//"},{label:"Chrome",versionReg:new RegExp(/Chrome(.*)\s/)},{label:"Safari",versionReg:new RegExp(/Safari(.*)/)}],n={platform:"",browser:"",browser_version:""};if(t.indexOf("Mobi")>-1){if(t.indexOf("Android")>-1){n.platform="mobile Android";const p=e.slice(1).find(x=>t.indexOf(x.label)>-1);n.browser=(p==null?void 0:p.label)||"",n.browser_version=((r=t.match((p==null?void 0:p.versionReg)||/.*/))==null?void 0:r[0])||""}t.indexOf("iPhone")>-1&&(n.platform="mobile iPhone"),t.indexOf("iPad")>-1&&(n.platform="iPad");const s=e.find(p=>t.indexOf(p.label)>-1);n.browser=(s==null?void 0:s.label)||"",n.browser_version=((i=t.match((s==null?void 0:s.versionReg)||/.*/))==null?void 0:i[0])||""}else if(t.indexOf("Mobi")>-1&&((a=navigator==null?void 0:navigator.platform)==null?void 0:a.indexOf("Win32"))>-1)n.platform="window桌面devTool手机模拟器";else if(((l=navigator==null?void 0:navigator.platform)==null?void 0:l.indexOf("MacIntel"))>-1||t.indexOf("Mac")>-1)n.platform="MacIntel";else if(t.indexOf("Windows")>-1){n.platform="Windows";const s=o.find(p=>t.indexOf(p.label)>-1);n.browser=(s==null?void 0:s.label)||"",n.browser_version=((c=t.match((s==null?void 0:s.versionReg)||/.*/))==null?void 0:c[0])||""}return n},Q=async(t,e)=>typeof fetch=="function"?(await fetch(e,{method:t})).json():new Promise((o,n)=>{const r=new window.XMLHttpRequest;r.open(t,e,!0),r.send(),r.onreadystatechange=()=>{r.readyState===4&&(r.status===200?o(JSON.parse(r.response)):n("Wrong status code."))}});let f={host:" ",project:" ",logstore:" ",time:10,count:10,topic:"topic",source:"Analysis",tags:{}};const _=class _{constructor(e){u(this,"tracker");u(this,"toReportQueue",[]);window._userData={},f={...f,...e.aliyun_config};const o=new b(f);this.tracker=o,this.toReportQueue.length&&this.toReportQueue.forEach(n=>this.logReport(n))}async getIpPhoneConf(e){const o=await Q("get",`http://47.119.183.29/app-api/get_ip_and_phone_info/${e}`),{ip_info:n,phone_info:r,server_ip:i}=o.data;window._userData.phone_info={phone:e,area_code:r.area_code,phone_province:r.province,phone_city:r.city,operator:r.phone_type},window._userData.position={server_ip:i,client_ip:n.ip,client_ip_region:n.country,client_ip_province:n.region,client_ip_city:n.city,longitude:n.longitude,latitude:n.latitude}}reportPageView(e){return this.logReport({eventType:d.evt_page_view,track_version:_.sdk_version,key_url:location.href,...e})}async initReport(e){var r,i;await this.getIpPhoneConf(e);const[o]=navigator.userAgent.match(new RegExp("(?<=\\()(.+?)(?=\\))","g")),n=A(navigator.userAgent);this.logReport([{eventType:d.evt_device_info,...window._userData.position,device:navigator.vendor||"Firefox",device_type:"device_type",device_height:screen.height,device_width:screen.width,os:n.platform||(navigator==null?void 0:navigator.oscpu),os_version:o||(navigator==null?void 0:navigator.oscpu),browser:n.browser,browser_version:n.browser_version,browser_ua:navigator.userAgent,package:"package",app_name:"app_name",app_version:"app_version",traffic_type:(r=navigator.connection)==null?void 0:r.effectiveType,operator:window._userData.phone_info.operator,network_type:((i=navigator.connection)==null?void 0:i.type)||"",device_id:"device_id",lang:navigator.language},{eventType:d.evt_visit_source,collect:"collect",share:"share",entrance_url:document.referrer,entrance_type:"entrance_type",channel_type:"channel_type"}])}logReport(e,o){var n;return Array.isArray(e)?(e=e.map(r=>{var i;return r.user_id=(i=window._userData)==null?void 0:i.user_id,r}),this.tracker===void 0?this.toReportQueue.push(e):o?this.tracker.sendBatchLogsImmediate(e):this.tracker.sendBatchLogs(e)):(e={...e,user_id:(n=window._userData)==null?void 0:n.user_id},this.tracker===void 0?this.toReportQueue.push(e):o?this.tracker.sendImmediate(e):this.tracker.send(e))}};u(_,"sdk_version","1.0.0");let w=_;const v=window.Log=new w({aliyun_config:{host:"cn-guangzhou.log.aliyuncs.com",project:"project-webtrcking-qiheng-2024",logstore:"log-cdn-store",time:3,count:10,topic:"topic",source:"Analysis",tags:{}}});function m(t,e){return function(...o){window.Log.logReport({eventType:e,console_content:o.map(n=>H(n))}),t.apply(window,o)}}console.log=m(console.log,d.evt_console_log);console.error=m(console.error,d.evt_console_error);console.warn=m(console.warn,d.evt_console_warn);const h=function(t){return function(...e){var o;t.apply(window.history,e),(o=window.Log)==null||o.reportPageView({session_id:"session_id",product_id:130,product_name:"product_name",page_cnt:1e4,clause_status:"clause_status"})}};history.back=h(history.back);history.forward=h(history.forward);history.go=h(history.go);history.pushState=h(history.pushState);history.replaceState=h(history.replaceState);v.initReport("13856984586");function C(){window.onerror=function(t,e,o,n,r){v.logReport({eventType:d.evt_error,content:`【${t}】:${r==null?void 0:r.stack} 第${o}行 第${n}列`})},window.addEventListener("unhandledrejection",({reason:{message:t,stack:e}})=>{v.logReport({eventType:d.evt_unhandledrejection,content:`【${t}】:${e}`})})}C();window.addEventListener("beforeunload",()=>{const[t]=window.performance.getEntriesByType("navigation");let e=0;const o=performance.timeOrigin,n=window.performance.getEntriesByType("resource").map(r=>{var i;return e+=r.duration,{resource_name:(i=r.name.match(/\/[^/]*$/))==null?void 0:i[0],encodedBodySize:r.encodedBodySize,initiatorType:r.initiatorType,resource_load_start:o+r.startTime,resource_load_end:o+r.responseEnd,loadTime:r.duration}});window.Log.logReport({eventType:d.evt_performance,page_load_start:o+t.startTime,page_load_end:o+t.loadEventEnd,key_resourceloadTime:e,key_resourceArray:n},!0)});let R={};window.addEventListener("click",t=>{var l,c;const{pageX:e,pageY:o,screenX:n,screenY:r}=t;R={pageX:e,pageY:o,screenX:n,screenY:r};const i=(l=t.target)==null?void 0:l.id,a=(c=window._reportData)==null?void 0:c[i];!i||!a||window.Log.logReport({...a})});window.addEventListener("input",L(t=>{window.Log.logReport({eventType:d.evt_click,record_time:new Date(t.timeStamp+performance.timeOrigin),location_coor:R,...j()})},3e3));
